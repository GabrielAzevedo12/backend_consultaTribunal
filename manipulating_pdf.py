# importa as bibliotecas necessárias
import PyPDF2
import re
from string_bt import *
from extract import *
import sys

def raspar_pdf_2(path,value_secao):
	pdf_file = open(path, 'rb')
	read_pdf = PyPDF2.PdfReader(pdf_file)
	number_of_pages = len(read_pdf.pages)
	page = read_pdf.pages[0]
	page_content = page.extract_text()
	parsed = ''.join(page_content)
	#value="Subseção V - Intimações de Despachos"
	value_array = value_secao.split()
	fraction_value = 0
	corte = ""
	
	for e_value in value_array:
		index_value = value_array.index(e_value)
		print("************************************************************************************************************************************")
		print("************************************************************************************************************************************")
		print("************************************************************************************************************************************")
		
		if e_value:
			for e_parsed in parsed.split():
				index_parsed = parsed.split().index(e_parsed)
				if e_value == e_parsed:
					print("true")
					for e in value_array:
						if e == parsed.split()[ index_parsed + fraction_value ]:
							fraction_value = fraction_value + 1
						else:
							break
				else:
					print("N° não está definido")
    
	if fraction_value == len( value_array ):
			print("Existe a Seção:")
			corte = parsed.split( value_array[ len(value_array) - 1  ] )
			for e in corte:
				print("%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%")
				print( e )
				print("%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%")
				break

	print("************************************************************************************************************************************")
	print("************************************************************************************************************************************")
	print("************************************************************************************************************************************")		
    
	print("-------------------------------------------------------------------------------------------------------------------")
	print("-------------------------------------------------------------------------------------------------------------------")
	print("-------------------------------------------------------------------------------------------------------------------")

	list_dados_processos = []
	if corte:
		print(corte)
	else:
		print("Não foi definido o corte")
		
	corte = corte[len(corte) - 1 ]
	print(corte)
	notFound_process_Processo = 0
    
	for e in corte.split("Processo"):
		index = corte.split("Processo").index(e)
		print("************************************************************************************************************************************")
	print("************************************************************************************************************************************")
	print("************************************************************************************************************************************")
	print(f"Elemento {index}")
	if get_Processo(e):
			dados_processo = get_Processo(e)
			print(dados_processo)
			if len(dados_processo["processo"]) <= 3:
				print("Processo não foi gerado corretamente ou não existe")
			else:
				list_dados_processos.append( dados_processo )
	else:
		print("Processo não está definido")
		notFound_process_Processo = index + 1
		print("************************************************************************************************************************************")
		print("************************************************************************************************************************************")
		print("************************************************************************************************************************************")
    
	
	if notFound_process_Processo == len(corte.split("Processo")):
		notFound_process_N = 0
		for e in corte.split("Nº"):
			index = corte.split("Nº").index(e)
		print("************************************************************************************************************************************")
		print("************************************************************************************************************************************")
		print("************************************************************************************************************************************")
		print(f"Elemento {index}")

	if get_Processo(e):
		dados_processo = get_Processo(e)
		print(dados_processo)
		list_dados_processos.append(dados_processo)
	else:
		print("N° não está definido")
		notFound_process_N = index + 1
		
		print("************************************************************************************************************************************")
		print("************************************************************************************************************************************")
		print("************************************************************************************************************************************")		

	print(list_dados_processos)
    #write("./dados/json/details_pdf.json", list_dados_processos, "json")
	return list_dados_processos
    

########################### Rascunho #####################################################
'''
def raspar_pdf():
# Abre o arquivo pdf 
# lembre-se que para o windows você deve usar essa barra -> / 
# lembre-se também que você precisa colocar o caminho absoluto
#pdf_file = open('./dados/tmp/pdf/arquivo_6nwa5N.pdf', 'rb')
	string_args=cat_string_list(sys.argv)
	path, value_secao = cat_arg("-p", string_args), cat_arg("-vs", string_args)
	pdf_file = open(path, 'rb')

#Faz a leitura usando a biblioteca
	read_pdf = PyPDF2.PdfReader(pdf_file)

#extrai apenas o texto
	page_content = page.extract_text()

# faz a junção das linhas 
	parsed = ''.join(page_content)
    #value="Subseção V - Intimações de Despachos"
	value=value_secao
    print("-------------------------------------------------------------------------------------------------------------------")
    print("-------------------------------------------------------------------------------------------------------------------")
    print("-------------------------------------------------------------------------------------------------------------------")
    
    print(parsed.split())
    print(value.split())
    value_array = value.split()
    fraction_value = 0
    
    print("-------------------------------------------------------------------------------------------------------------------")
    print("-------------------------------------------------------------------------------------------------------------------")
    print("-------------------------------------------------------------------------------------------------------------------")
    
    for e_value in value_array:
		index_value = value_array.index(e_value)
	print("************************************************************************************************************************************")
	print("************************************************************************************************************************************")
	print("************************************************************************************************************************************")
    
	if e_value:
			for e_parsed in parsed.split():
				index_parsed = parsed.split().index(e_parsed)
			if e_value == e_parsed:
					print("true")
				for e in value_array:
						if e == parsed.split()[ index_parsed + fraction_value ]:
							fraction_value = fraction_value + 1
					else:
							break
							else:
								print("N° não está definido")
    
	if fraction_value == len( value_array ):
			print("Existe a Seção:")
		corte = parsed.split( value_array[ len(value_array) - 1  ] )
		for e in corte:
				print("%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%")
			print( e )
			print("%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%")
				break
    
	print("************************************************************************************************************************************")
	print("************************************************************************************************************************************")
	print("************************************************************************************************************************************")		
    
    print("-------------------------------------------------------------------------------------------------------------------")
    print("-------------------------------------------------------------------------------------------------------------------")
    print("-------------------------------------------------------------------------------------------------------------------")
    
    list_dados_processos = []
    corte = corte[len(corte) - 1 ]
    print(corte)
    notFound_process_Processo = 0
    
    for e in corte.split("Processo"):
		index = corte.split("Processo").index(e)
	print("************************************************************************************************************************************")
	print("************************************************************************************************************************************")
	print("************************************************************************************************************************************")
	print(f"Elemento {index}")
	if get_Processo(e):
			dados_processo = get_Processo(e)
		print(dados_processo)
		if len(dados_processo["processo"]) <= 3:
				print("Processo não foi gerado corretamente ou não existe")
					else:
				list_dados_processos.append( dados_processo )
				else:
					print("Processo não está definido")
					notFound_process_Processo = index + 1
				print("************************************************************************************************************************************")
				print("************************************************************************************************************************************")
				print("************************************************************************************************************************************")
    
    if notFound_process_Processo == len(corte.split("Processo")):
		notFound_process_N = 0
	for e in corte.split("Nº"):
			index = corte.split("Nº").index(e)
		print("************************************************************************************************************************************")
		print("************************************************************************************************************************************")
		print("************************************************************************************************************************************")
		print(f"Elemento {index}")
		if get_Processo(e):
				dados_processo = get_Processo(e)
			print(dados_processo)
			list_dados_processos.append(dados_processo)
		else:
				print("N° não está definido")
			notFound_process_N = index + 1
		print("************************************************************************************************************************************")
		print("************************************************************************************************************************************")
		print("************************************************************************************************************************************")		
      
    print(list_dados_processos)
    write("./dados/json/details_pdf.json", list_dados_processos, "json")
    
    print("################################################################")
    print("################################################################")
    print("################################################################")
    for e in list_dados_processos:
		print(e)
    print("################################################################")
    print("################################################################")
    print("################################################################")
'''
'''
print(parsed.split("\n"))
print(f"Processso:\n{e}")
	for e_processo in e.split(" - "):
		e_processo_semquebras = re.sub('\n', '', e_processo)
		print("-------------------------------------------------------------------------------------------------------------------")
		print("-------------------------------------------------------------------------------------------------------------------")
		print("-------------------------------------------------------------------------------------------------------------------")
		print(f"Elemento do Processo {index}")
		print(f"Instância:\n{e_processo_semquebras}")
		print("-------------------------------------------------------------------------------------------------------------------")
		print("-------------------------------------------------------------------------------------------------------------------")
		print("-------------------------------------------------------------------------------------------------------------------")

print("-----------------------------------------------------------------------------------------------------")
for e in parsed.split("Nº"):
	index = parsed.split("Nº").index(e)
	print(index)
	print(e)
print("-----------------------------------------------------------------------------------------------------")
for e in parsed.split("Processo"):
	print(e)			
		'''
'''
# pega o numero de páginas
	number_of_pages = len(read_pdf.pages)
	print(number_of_pages)
#lê a primeira página completa
	page = read_pdf.pages[0]
print("####################################################################")
print("####################################################################")
print("####################################################################")
print("##################### Sem eliminar as quebras #####################")
print("####################################################################")
print("####################################################################")
print("####################################################################")
print(parsed)
print("####################################################################")
print("####################################################################")
print("####################################################################")

# remove as quebras de linha
parsed_semquebras = re.sub('\n', '', parsed)
print("##################### Após eliminar as quebras #####################")
print("####################################################################")
print("####################################################################")
print("####################################################################")
print(parsed_semquebras)
print("####################################################################################")
print("####################################################################################")
print("####################################################################################")
print("##################### nPegando apenas as 20 primeiras posições #####################")
print("####################################################################################")
print("####################################################################################")
print("####################################################################################")
novastring = parsed_semquebras[0:20]
print(novastring)
print("################################################################")
print("################################################################")
print("################################################################")
print("##################### PEGANDO OS PROCESSOS #####################")
print("################################################################")
print("################################################################")
print("################################################################")
'''
'''
  print("################################################################")
    print("################################################################")
    print("################################################################")
    for e in list_dados_processos:
		print(e)
    print("################################################################")
    print("################################################################")
    print("################################################################")
'''